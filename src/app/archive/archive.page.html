<!--
<ion-header>
  <ion-toolbar>
    <ion-title id="title">{{ 'ARCHIVE.TRACKS' | translate  }}</ion-title>
    <ion-buttons slot="end">
      <ion-button class="header-button" shape="round" fill="solid" (click)="openMenu()">
        <ion-icon slot="icon-only" name="menu"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="custom-content">
  <div class="ion-content-scroll-host">
    <ion-list>
      @for (item of fs.collection; track item) {
        <ion-item>
          <ion-checkbox
            slot="start"
            justify="space-between"
            [(ngModel)]="item.isChecked"
            (ionChange)="onChange()"
            labelPlacement="end"
          >
            <ion-label [ngClass]="item.isChecked ? 'checked' : 'unchecked'">
              {{ item.name }}<br>
              {{ item.date | date: 'dd-MM-yyyy HH:mm' }}<br>
              {{ item.place }}
            </ion-label>
          </ion-checkbox>
        </ion-item>
      }
    </ion-list>
  </div>

  <div class="safe-area"></div>

  <ion-menu side="start" contentId="main-content">
    <ion-content>
      <ion-list>
        <ion-item class="menu-button" button [disabled]="!geography.searchLayer?.getSource()?.getFeatures()?.length" (click)="removeSearch()">{{'ARCHIVE.REMOVE_SEARCH' | translate}}</ion-item>
        <ion-item class="menu-button" button [disabled]='(numChecked != 1)' (click)="exportTrackFile()">{{'ARCHIVE.EXPORT_FILE' | translate}}</ion-item>
        <ion-item class="menu-button" button [disabled]='(numChecked != 1)' (click)="prepareImageExport()">{{'ARCHIVE.EXPORT_TRACK' | translate}}</ion-item>
        <ion-item class="menu-button" button [disabled]="!!geography.archivedLayer?.getSource()?.getFeatures()?.length && !reference.archivedTrack" (click)="displayAllTracks(true)">{{'ARCHIVE.DISPLAY_ALL' | translate}}</ion-item>
        <ion-item class="menu-button" button [disabled]="!geography.archivedLayer?.getSource()?.getFeatures()?.length || reference.archivedTrack" (click)="displayAllTracks(false)">{{'ARCHIVE.HIDE_ALL' | translate}}</ion-item>
        <ion-item class="menu-button" button [disabled]='(numChecked == 0)' (click)="deleteTracks()">{{'ARCHIVE.REMOVE_TRACKS' | translate}}</ion-item>
        <ion-item class="menu-button" button [disabled]='(numChecked != 1)' (click)="editTrack()">{{'ARCHIVE.EDIT_TRACK' | translate}}</ion-item>
        <ion-item class="menu-button" button [disabled]='(numChecked != 1)' (click)="displayTrack(true)">{{'ARCHIVE.SHOW_REFERENCE' | translate}}</ion-item>
        <ion-item class="menu-button" button [disabled]="(!reference.archivedTrack)" (click)="displayTrack(false)">{{'ARCHIVE.HIDE_REFERENCE' | translate}}</ion-item>

      </ion-list>
    </ion-content>
  </ion-menu>
  <ion-content id="main-content"></ion-content>
</ion-content>
-->

<ion-content class="custom-content">
  <div class="ion-content-scroll-host">
    <ion-list lines="full" class="archive-list">
      @for (item of fs.collection; track item; let i = $index) {
        <ion-item-sliding #slidingItem>
          
          <ion-item-options side="start">
            <ion-item-option 
              [color]="isTrackVisible(item) ? 'medium' : 'primary'" 
              (click)="toggleVisibility(item, slidingItem)">
              <ion-icon slot="top" [name]="isTrackVisible(item) ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
              {{ (isTrackVisible(item) ? 'ARCHIVE.HIDE_REFERENCE' : 'ARCHIVE.SHOW_REFERENCE') | translate }}
            </ion-item-option>
            <ion-item-option color="secondary" (click)="presentExportOptions(item, slidingItem)">
              <ion-icon slot="top" name="share-outline"></ion-icon>
              {{ 'ARCHIVE.EXPORT_TRACK' | translate }}
            </ion-item-option>
          </ion-item-options>

          <ion-item>
            <ion-checkbox slot="start" [(ngModel)]="item.isChecked" (ionChange)="onChange()"></ion-checkbox>
            
            <ion-label (click)="toggleCheck(item)">
              <div class="item-content">
                <strong [class.active-text]="isTrackVisible(item)">{{ item.name }}</strong>
                <p class="item-date-subtitle">{{ item.date | date: 'dd-MM-yyyy' }}</p>
              </div>
            </ion-label>
            
            @if (isTrackVisible(item)) {
              <ion-badge slot="end" color="success">Visible</ion-badge>
            }
          </ion-item>

          <ion-item-options side="end">
            <ion-item-option color="tertiary" (click)="editSpecificTrack(i, slidingItem)">
              <ion-icon slot="top" name="create-outline"></ion-icon>
              {{ 'ARCHIVE.EDIT_TRACK' | translate }}
            </ion-item-option>
            <ion-item-option color="danger" (click)="confirmDeletion(i, slidingItem)">
              <ion-icon slot="top" name="trash-outline"></ion-icon>
              {{ 'ARCHIVE.REMOVE_TRACK' | translate }}
            </ion-item-option>
          </ion-item-options>

        </ion-item-sliding>      
      }
    </ion-list>
    
    <div class="list-spacer"></div>
  </div>
</ion-content>

<!-- space for android controls -->
<div class="bottom-safe-gray"></div>

<ion-fab slot="fixed" horizontal="center" vertical="bottom" class="bottom-safe">
  <ion-row>
    <div class="record-button archive-color" (click)="fs.gotoPage('tab1')">
      <ion-icon name="earth-sharp"></ion-icon>
      <span>{{ 'MAP.MAP_BUTTON' | translate }}</span>
    </div>
    <div class="record-button archive-color" (click)="fs.gotoPage('canvas')">
      <ion-icon name="analytics-sharp"></ion-icon>
      <span>{{ 'MAP.DATA_BUTTON' | translate }}</span>
    </div>
    <div class="record-button archive-color" (click)="fs.gotoPage('settings')">
      <ion-icon name="settings-sharp"></ion-icon>
      <span>{{ 'MAP.SETTINGS_BUTTON' | translate }}</span>
    </div>
  </ion-row>
</ion-fab>

<!-- Deletion confirmation popover -->

<ion-popover
  [isOpen]="isConfirmDeletionOpen"
  (didDismiss)="isConfirmDeletionOpen = false"
>
  <ng-template>
    <ion-list>
      <ion-item class="confirm" lines="none">
        <ion-label><strong>{{ 'RECORD.CONFIRM_DELETION' | translate }}</strong></ion-label>
      </ion-item>
      <ion-row>
        <button class="record-button green-color"
          (click)=" deleteTrack(); isConfirmDeletionOpen = false"
        >
          <ion-icon name="happy-sharp"></ion-icon>
          <span>{{ 'RECORD.DELETE_YES' | translate }}</span>
        </button>
        <button class="record-button red-color"
          (click)="isConfirmDeletionOpen = false"
        >
          <ion-icon name="sad-sharp"></ion-icon>
          <span>{{ 'RECORD.DELETE_NO' | translate }}</span>
        </button>
      </ion-row>
    </ion-list>
  </ng-template>
</ion-popover>
