<!-- HEADER TOOLBAR --> 

<ion-header>
  <ion-toolbar>
    <ion-title>{{ 'ARCHIVE.TRACKS' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<!-- REGULAR CONTENT -->

<ion-content class="custom-content">
  <div class="ion-content-scroll-host">
    <ion-list lines="full">
      @for (item of fs.collection; track item; let i = $index) {
        <ion-item-sliding #slidingItem>
          <ion-item-options side="start">
            <ion-item-option 
              [color]="isTrackVisible(item) ? 'medium' : 'primary'" 
              (click)="toggleVisibility(item, slidingItem)">
              <ion-icon slot="top" [name]="isTrackVisible(item) ? 'eye-off-sharp' : 'eye-sharp'"></ion-icon>
              {{ (isTrackVisible(item) ? 'ARCHIVE.HIDE' : 'ARCHIVE.SHOW') | translate }}
            </ion-item-option>
            <ion-item-option color="secondary" (click)="exportTrackFile(item, slidingItem)">
              <ion-icon slot="top" name="share-sharp"></ion-icon>
              {{ 'ARCHIVE.EXPORT_TRACK' | translate }}
            </ion-item-option>
          </ion-item-options>
          <ion-item>
            <ion-icon name="chevron-forward-sharp" slot="start" color="medium" style="font-size: 12px;"></ion-icon> 
            <ion-label>
              <div class="item-content">
                <strong [class.active-text]="isTrackVisible(item)">{{ item.name }}</strong>
                <p class="item-date-subtitle">{{ item.date | date: 'dd-MM-yyyy' }}</p>
              </div>
            </ion-label>
              @if (isTrackVisible(item)) {
                <ion-badge slot="end" color="success">
                  {{ 'ARCHIVE.VISIBLE_LABEL' | translate }}
                </ion-badge>
              }
            <ion-icon name="chevron-back-sharp" slot="end" color="medium" style="font-size: 12px;"></ion-icon>
          </ion-item>
          <ion-item-options side="end">
            <ion-item-option color="tertiary" (click)="editSpecificTrack(i, slidingItem)">
              <ion-icon slot="top" name="create-sharp"></ion-icon>
              {{ 'ARCHIVE.EDIT_TRACK' | translate }}
            </ion-item-option>
            <ion-item-option color="danger" (click)="confirmDeletion(i, slidingItem)">
              <ion-icon slot="top" name="trash-sharp"></ion-icon>
              {{ 'ARCHIVE.REMOVE_TRACK' | translate }}
            </ion-item-option>
          </ion-item-options>
        </ion-item-sliding>      
      }
    </ion-list> <div class="list-spacer"></div>
  </div>
</ion-content>

<!-- SPACE FOR ANDROID CONTROLS -->

<div class="bottom-safe-gray"></div>

<!-- DELETION CONFIRMATION POPOVER -->

<ion-popover
  [isOpen]="isConfirmDeletionOpen"
  (didDismiss)="isConfirmDeletionOpen = false"
  class="confirm-popover">
  <ng-template>
    <div class="popover-island confirm-box">
      <p class="confirm-title">{{ 'RECORD.CONFIRM_DELETION' | translate }}</p>
      <div class="button-grid horizontal">
        <button class="nav-item-btn green-pill" (click)="deleteTrack(); isConfirmDeletionOpen = false">
          <ion-icon name="checkmark-sharp"></ion-icon>
          <p>{{ 'RECORD.DELETE_YES' | translate }}</p>
        </button>
        <button class="nav-item-btn red-pill" (click)="isConfirmDeletionOpen = false">
          <ion-icon name="close-sharp"></ion-icon>
          <p>{{ 'RECORD.DELETE_NO' | translate }}</p>
        </button>
      </div>
    </div>
  </ng-template>
</ion-popover>

<!-- FAB CON EL BOTON SUPERIOR PARA MOSTRAR O ESCONDER TODOS LOS TRAYECTOS -->

<ion-fab slot="fixed" horizontal="end" vertical="top" class="top-safe-archive">
  <div class="record-button" 
       [class.red-pill]="mapService.visibleAll"
       (click)="displayAllTracks(!mapService.visibleAll)">
    
    <ion-icon 
      [name]="mapService.visibleAll ? 'eye-off-sharp' : 'eye-sharp'" 
      [class.blue-icon]="!mapService.visibleAll">
    </ion-icon>
    
    <span>{{ 'ARCHIVE.ALL' | translate }}</span>
  </div>
</ion-fab>

<!-- MAPA OCULTO -->

<div id="export-container" style="position: absolute; top: 0; left: 0; width: 800px; height: 600px; opacity: 0; z-index: -1; pointer-events: none;">
  <div id="map-export" style="width: 100%; height: 100%;"></div>
</div>

<ion-fab slot="fixed" horizontal="center" vertical="bottom" class="bottom-safe">
  <ion-row>
    <div class="record-button" (click)="fs.gotoPage('tab1')">
      <ion-icon name="earth-sharp"></ion-icon>
      <span>{{ 'MAP.MAP_BUTTON' | translate }}</span>
    </div>
    <div class="record-button" (click)="fs.gotoPage('canvas')">
      <ion-icon name="bar-chart-sharp"></ion-icon>
      <span>{{ 'MAP.DATA_BUTTON' | translate }}</span>
    </div>
    <div class="record-button" (click)="fs.gotoPage('settings')">
      <ion-icon name="settings-sharp"></ion-icon>
      <span>{{ 'MAP.SETTINGS_BUTTON' | translate }}</span>
    </div>
  </ion-row>
</ion-fab>

