<ion-popover
  [isOpen]="isGuidePopoverOpen"
  (didDismiss)="isGuidePopoverOpen = false"
  cssClass="long"
>
  <ng-template>
    <ion-content class="search-popover-content">

      <div class="search-section">

        <!-- SELECTED FROM -->
        @if (selected[1]) {
          <div class="selected-box">
              <ion-icon name="checkmark-circle" class="ok-icon"></ion-icon>
              <div class="selected-text">
                <strong>{{ 'SEARCH.FROM' | translate }}</strong><br>
                {{ $any(selected[1])?.short_name }}
              </div>
              <button class="change-button" (click)="changeLocation(1)">
                {{ 'SEARCH.CHANGE' | translate }}
              </button>
            </div>
        }

        <!-- INPUT FROM -->
        @if (!selected[1]) {
          <div class="search-row">
            <div class="search-field">
              <ion-icon name="search" class="search-icon"></ion-icon>

              <ion-input
                [(ngModel)]="query[1]"
                [placeholder]="'SEARCH.FROM' | translate"
                class="search-input"
              ></ion-input>

              @if (query[1]) {
                <ion-icon
                  name="close-circle"
                  class="clear-icon"
                  (click)="clearInput(1)"
                ></ion-icon>
              }

              <ion-icon
                name="mic"
                class="mic-icon"
                (click)="startDictation(1)"
              ></ion-icon>
            </div>

            <button class="list-button" (click)="openList(1)">
              <ion-icon name="list" class="list-icon"></ion-icon>
              <span>{{ 'SEARCH.LIST' | translate }}</span>
            </button>
          </div>
        }

        <!-- RESULTS FROM -->
        @if ((results?.[1]?.length ?? 0) > 0) {
          <ion-list class="results-list">
            @for (r of (results?.[1] ?? []); track r) {
              <ion-item (click)="selectResult(1, r)">
                <ion-label>{{ r.display_name }}</ion-label>
              </ion-item>
            }
          </ion-list>
        }

        <!-- SELECTED TO -->
        @if (selected[2]) {
          <div class="selected-box">
              <ion-icon name="checkmark-circle" class="ok-icon"></ion-icon>
              <div class="selected-text">
                <strong>{{ 'SEARCH.TO' | translate }}</strong><br>
                {{ $any(selected[2])?.short_name }}
              </div>
              <button class="change-button" (click)="changeLocation(2)">
                {{ 'SEARCH.CHANGE' | translate }}
              </button>
            </div>
        }

        <!-- INPUT TO -->
        @if (!selected[2]) {
          <div class="search-row">
            <div class="search-field">
              <ion-icon name="search" class="search-icon"></ion-icon>

              <ion-input
                [(ngModel)]="query[2]"
                [placeholder]="'SEARCH.TO' | translate"
                class="search-input"
              ></ion-input>

              @if (query[2]) {
                <ion-icon
                  name="close-circle"
                  class="clear-icon"
                  (click)="clearInput(2)"
                ></ion-icon>
              }

              <ion-icon
                name="mic"
                class="mic-icon"
                (click)="startDictation(2)"
              ></ion-icon>
            </div>

            <button class="list-button" (click)="openList(2)">
              <ion-icon name="list" class="list-icon"></ion-icon>
              <span>{{ 'SEARCH.LIST' | translate }}</span>
            </button>
          </div>
        }

        <!-- RESULTS TO -->
        @if ((results?.[2]?.length ?? 0) > 0) {
          <ion-list class="results-list">
            @for (r of (results?.[2] ?? []); track r) {
              <ion-item (click)="selectResult(2, r)">
                <ion-label>{{ r.display_name }}</ion-label>
              </ion-item>
            }
          </ion-list>
        }

        <!-- TRANSPORT -->
        @if (selected[1] && selected[2]) {
          <div class="transport-section">
            <h3 class="transport-title">{{ 'SEARCH.TRANSPORT' | translate }}</h3>

            <div class="transport-buttons">
              @for (t of transportOptions; track t.key) {
                <button
                  class="transport-btn"
                  [class.active]="transport === t.key"
                  (click)="selectTransport(t.key)"
                >
                  <ion-icon *ngIf="t.icon" [name]="t.icon" class="transport-icon"></ion-icon>
                  <span>{{ 'SEARCH.TRANSPORTATION_MEANS.' + t.key | translate }}</span>
                </button>
              }
            </div>
          </div>
        }

      </div>

    </ion-content>
  </ng-template>
</ion-popover>
